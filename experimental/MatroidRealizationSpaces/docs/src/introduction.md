```@meta
CurrentModule = Oscar
CollapsedDocStrings = true
DocTestSetup = Oscar.doctestsetup()
```

# Matroid Realization Spaces


Let ``M`` be a matroid of rank ``d`` on a ground set ``E`` of size ``n``. Its
*realization space* ``\mathcal{R}(M)`` is an affine scheme that parameterizes
all hyperplane arrangements that realize the matroid ``M`` (up to the action of
``PGL(r)``).  We provide functions that determine the affine coordinate ring of
``\mathcal{R}(M)``. 


```@docs
is_realizable(M::Matroid; char::Union{Int,Nothing}=nothing, q::Union{Int,Nothing}=nothing)
defining_ideal(RS::MatroidRealizationSpace)
inequations(RS::MatroidRealizationSpace)
ambient_ring(RS::MatroidRealizationSpace)
realization_space(M::Matroid; B::Union{GroundsetType,Nothing} = nothing, 
    F::AbstractAlgebra.Ring = ZZ, saturate::Bool=false, reduce::Bool=true,
    char::Union{Int,Nothing}=nothing, q::Union{Int,Nothing}=nothing)
realization(M::Matroid; B::Union{GroundsetType,Nothing} = nothing, 
    F::AbstractAlgebra.Ring = ZZ, saturate::Bool=false, reduce::Bool=true,
    char::Union{Int,Nothing}=nothing, q::Union{Int,Nothing}=nothing)
realization(RS::MatroidRealizationSpace)
```

If ``B`` is the polynomial ring `ambient_ring(RS)`, ``I`` the ideal
`defining_ideal(RS)`, and ``U`` the multiplicative semigroup generated by
`inequations(RS)`, then the coordinate ring of the realization space
``\mathcal{R}(M)`` is isomorphic to ``U^{-1}B/I``.  

### Matroid realization spaces as affine schemes
Every `MatroidRealizationSpace` is an instance of an affine scheme.  
For those cases where implementations exist, the
entire functionality provided for `AbsAffineScheme`s applies 
to matroid realization spaces. For example:
```jldoctest
julia> RM = realization_space(pappus_matroid(), ground_ring=QQ)
The realization space is
  [1   0   1   0   x2   x2                 x2^2    1    0]
  [0   1   1   0    1    1   -x1*x2 + x1 + x2^2    1    1]
  [0   0   0   1   x2   x1                x1*x2   x1   x2]
in the multivariate polynomial ring in 2 variables over QQ
avoiding the zero loci of the polynomials
RingElem[x1 - x2, x2, x1, x2 - 1, x1 + x2^2 - x2, x1 - 1, x1*x2 - x1 - x2^2]

julia> OO(RM)
Localization
  of quotient
    of multivariate polynomial ring in 2 variables x1, x2
      over rational field
    by ideal (0)
  at products of (x1 - x2, x2, x1, x2 - 1, x1 + x2^2 - x2, x1 - 1, x1*x2 - x1 - x2^2)

julia> is_smooth(RM) # Calls the generic routine implemented for schemes
true

julia> x, y = gens(OO(RM)); I = ideal(OO(RM), [x - 4, y^2 - 8]);

julia> pr = blow_up(RM, I)
Blowup
  of scheme over QQ covered with 1 patch
    1b: [x1, x2]   scheme(0) \ scheme((x1 - x2)*x2*x1*(x2 - 1)*(x1 + x2^2 - x2)*(x1 - 1)*(x1*x2 - x1 - x2^2))
  in sheaf of ideals with restriction
    1b: Ideal (x1 - 4, x2^2 - 8)
with domain
  scheme over QQ covered with 2 patches
    1a: [(s1//s0), x1, x2]   scheme(-(s1//s0)*x1 + 4*(s1//s0) + x2^2 - 8) \ scheme((x1 - x2)*x2*x1*(x2 - 1)*(x1 - 1)*(x1 + x2^2 - x2)*(x1*x2 - x1 - x2^2))
    2a: [(s0//s1), x2]       scheme(0) \ scheme(((s0//s1)*x2^2 - 8*(s0//s1) - x2 + 4)*x2*((s0//s1)*x2^2 - 8*(s0//s1) + 4)*(x2 - 1)*((s0//s1)*x2^2 - 8*(s0//s1) + 3)*((s0//s1)*x2^2 - 8*(s0//s1) + x2^2 - x2 + 4)*((s0//s1)*x2^3 - (s0//s1)*x2^2 - 8*(s0//s1)*x2 + 8*(s0//s1) - x2^2 + 4*x2 - 4))
and exceptional divisor
  effective cartier divisor defined by
    sheaf of ideals with restrictions
      1a: Ideal (x1 - 4)
      2a: Ideal (x2^2 - 8)
      
julia> first(affine_charts(codomain(pr))) === RM
true
```
Note, however, that there are also cases which are not covered. 
For instance, one realization of the `fano_matroid()` is ``\mathrm{Spec}(\mathbb Z/2 \mathbb Z)``
which is not (yet) supported by the schemes framework.

### Self-projecting realization spaces of self-projecting matroids

A matroid $M$ of rank $d$ on $[n]$ is self-projecting, if for any two rank $d-1$ flats $F_1,F_2$ there is no element $e\in[n]$ such that $F_1\cup F_2 = [n]\setminus e$. 
For self-projecting matroids one can compute the self-projecting realization space, a subspace of the realization space of the matroid. This space is the Zariski closre of the space of realizations $V$ which satisfy that there exists a diagonal matrix $D$ with only non-zero entries in the diagonal such that $V\cdot D\cdot V^t = 0$.

```@docs
is_selfprojecting(mat::Matroid)
satisfies_disjointbasisproperty(mat::Matroid)
defining_ideal(RS::MatroidRealizationSpaceSelfProjecting)
inequations(RS::MatroidRealizationSpaceSelfProjecting)
ambient_ring(RS::MatroidRealizationSpaceSelfProjecting)
selfprojecting_realization_ideal(m::Matroid; saturate::Bool = false, check::Bool = true)
selfprojecting_realization_space(m::Matroid;
  B::Union{GroundsetType,Nothing}=nothing, check::Bool = true)
selfprojecting_realization_matrix(m::Matroid, Bas::Vector{Int}; I::Union{Ideal,Nothing} = nothing, check::Bool = true)
dimension(MRS::MatroidRealizationSpaceSelfProjecting)
```

There is a collection with selfprojecting matroids and their (selfprojecting) realization spaces in [oscarDB](https://docs.oscar-system.org/dev/Experimental/OscarDB/introduction/). The object type for the database entries is ``SelfProjectingMatroidRealizations``. It has the following properties.

```@docs
name(MR::SelfProjectingMatroidRealizations)
matroid(MR::SelfProjectingMatroidRealizations)
rank(MR::SelfProjectingMatroidRealizations)
length_groundset(MR::SelfProjectingMatroidRealizations)
dim_r(MR::SelfProjectingMatroidRealizations)
dim_s(MR::SelfProjectingMatroidRealizations)
equality_of_realizationspaces(MR::SelfProjectingMatroidRealizations)
```


