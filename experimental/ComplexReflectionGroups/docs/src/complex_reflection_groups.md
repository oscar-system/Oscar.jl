```@meta
CurrentModule = Oscar
```

# Complex reflection groups

We begin with a short theoretical review of complex reflection groups to be precise about
definitions before we discuss the implemented functions. The standard reference is
[LT09](@cite).

## Theoretical review

Throughout, let $V$ be a finite-dimensional vector space over $\mathbb{C}$. The **fix
space** of an element $g \in \mathrm{GL}(V)$ is 

$$\mathrm{Fix}(g) = \{ v \in V \mid gv = v \} = \mathrm{Ker}(1-g) \;.$$

We call $g$ a (complex) **reflection** if $g$ is of *finite order* and its fix space is a
*hyperplane*. 

Let $(\cdot, \cdot)$ be an inner product on $V$. We always assume that $(\cdot, \cdot)$ is
linear in the first component and conjugate-linear in the second component. We say that $g$
leaves $(\cdot,\cdot)$ **invariant**, or that $g$ is a **unitrary** transformation with
respect to $(\cdot,\cdot)$, if $(gv,gw) = (v,w)$ for all $v,w \in V$. It is a standard fact
that if $G \subset \mathrm{GL}(V)$ is a *finite* subgroup, then there exists a inner product
on $V$ which is $G$-invariant, i.e. $g$-invariant for all $g \in G$.

Now, let $g \in \mathrm{GL}(V)$ be a reflection. Since $g$ is a assumed to be of finite
order, the group $\langle g \rangle \subset \mathrm{GL}(V)$ is of finite order and so there
exists a $g$-invariant inner product on $V$. We then say that $g$ is a **unitary
reflection** with respect to such an inner product. The orthogonal decomposition

$$V = \mathrm{Ker}(1-g) \oplus \mathrm{Ker}(1-g)^\perp$$

is $g$-stable and

$$\mathrm{Ker}(1-g)^\perp = \mathrm{Im}(1-g)$$

so that we have a $g$-stable orthogonal decomposition

$$V = \mathrm{Ker}(1-g) \oplus \mathrm{Im}(1-g)^\perp \;.$$

Since $\mathrm{Ker}(1-g)$ is a hyperplane, the complement $\mathrm{Im}(1-g)$ is a line. A
non-zero element $\alpha$ on this line is called a **root** of $g$. A root is unique up to
multiplication with a non-zero scalar. We then have $g \alpha = \zeta \alpha$ for some
primitive $m$-th root of unity $\zeta$, where $m$ is the order of $g$.

Let $V^*$ be the dual space of $V$ and let $\langle \cdot, \cdot \rangle \colon V^* \times
V$ be the canonical pairing $\langle \varphi,v \rangle = \varphi(v)$. Since this pairing is
perfect, the "orthogonal" complement of the hyperplane $H = \mathrm{Ker}(1-g)$ with respect
to this pairing is 1-dimensional. This means that a linear form $L_H \in V^*$ with
$\mathrm{Ker}(L_H) = H$ is unique up to multiplication with a non-zero scalar. Note that
$\alpha \notin H$, so $L_H(\alpha) \neq 0$, and from the decomposition $V = H \oplus \langle
\alpha \rangle$ we see that we can write $g$ as

$$gv = v - (1-\zeta)\frac{L_H(v)}{L_H(\alpha)} \alpha \;.$$

Set

$$\alpha^\vee = (1-\zeta)\frac{L_H(\cdot)}{L_H(\alpha)} \in V^*$$

so that

$$gv = v - \alpha^\vee(v) \alpha \;.$$

Note that $\alpha^\vee$ is the unique linear form on $V$ with $\mathrm{Ker}(\alpha^\vee) =
H$ and

$$\alpha^\vee(\alpha) = 1-\zeta \;.$$

We call $\alpha^\vee$ the **coroot** of $g$ with respect to $\alpha$. If $g$ is unitary with
respect to an inner product $(\cdot, \cdot)$, we can take $L_H = (\cdot,\alpha)$ so that 

$$\alpha^\vee = (1-\zeta) \frac{(\cdot,\alpha)}{(\alpha,\alpha)} \;.$$



!!! warning 
    In OSCAR—like in most computer algebra systems—matrices $A$ act from the *right*
    on vectors $x$ and consequently the kernel of $A$ consists of the vectors $x$ with $xA =
    0$. The same applies to the image and any other construction involving the action. In
    the written literature, however, matrices usually act from the *left*. Hence, to
    transfer results between the computer and the literature, one usually needs to
    *transpose* the matrices.

 

## Showcase
As a demonstration, we create the exceptional complex reflection group $G_{4}$ in the
notation of Shepard & Todd [ST54](@cite). We choose as *model*—meaning a concrete matrix
group—the unitary model from [LT09](@cite). The base field of this model is
$\mathbb{Q}(i,\omega)$ where $i$ is the imaginary unity and $\omega = \exp(2\pi i/3)$. The
group is generated by two unitary reflections. We display the first generator, verify that
it is indeed a unitary reflection, and then we compute additional data like a root, the
hyperplane, and the non-trivial eigenvalue of this reflection. We have implemented an own
type encapsulating such data of a reflection.

```jldoctest
julia> W = complex_reflection_group(4, :LT)
Matrix group of degree 2
  over relative number field of degree 2 over number field

julia> base_ring(W)
Relative number field with defining polynomial x^2 + x + 1
  over number field with defining polynomial x^2 + 1
    over rational field

julia> w = gens(W)[1]
[(-1//2*i - 1//2)*ω   (-1//2*i - 1//2)*ω]
[(-1//2*i + 1//2)*ω    (1//2*i - 1//2)*ω]

julia> is_complex_reflection(w)
true

julia> is_unitary(w)
true

julia> b,w_data = is_complex_reflection_with_data(w);

julia> w_data
Complex reflection of order 3 with root (1, (i + 1)*ω + i)

julia> hyperplane(w_data)
[1   (-i - 1)*ω - 1]

julia> eigenvalue(w_data)
-ω - 1
```

One can now run all avaialable matrix group functionality in OSCAR on this group. For 
example one can compute its invariant ring:

```jldoctest
julia> IR = invariant_ring(W)
Invariant ring
  of matrix group of degree 2 over relative number field

julia> fundamental_invariants(IR)
2-element Vector{MPolyDecRingElem{Hecke.RelSimpleNumFieldElem{AbsSimpleNumFieldElem}, AbstractAlgebra.Generic.MPoly{Hecke.RelSimpleNumFieldElem{AbsSimpleNumFieldElem}}}}:
 x[1]^4 + (-4*ω - 2)*x[1]^2*x[2]^2 + x[2]^4
 x[1]^5*x[2] - x[1]*x[2]^5
```

One feature of our implementation is that we explicitly support *different models*. The
reason is that different models may have different properties. For example, note that in the
above example the first fundamental invariant has a coefficient in which $\omega$ occurs,
so it is not defined over the rational numbers. It is somewhat surprising and astonishing
that it has been proven by Marin & Michel [MM10](@cite) that there always exists a model
having the property that they have a system of fundamental invariants defined over the
rational numbers. These models are implemented in CHEVIE [Mic15](@cite). We again look at
$G_4$.

```jldoctest
julia> W = complex_reflection_group(4, :CHEVIE)
Matrix group of degree 2
  over cyclotomic field of order 3

julia> gens(W)
2-element Vector{MatrixGroupElem{AbsSimpleNumFieldElem, AbstractAlgebra.Generic.MatSpaceElem{AbsSimpleNumFieldElem}}}:
 [1 0; 0 z_3]
 [2//3*z_3+1//3 2//3*z_3-2//3; 1//3*z_3-1//3 1//3*z_3+2//3]

julia> IR = invariant_ring(W)
Invariant ring
  of matrix group of degree 2 over cyclotomic field of order 3

julia> fundamental_invariants(IR)
2-element Vector{MPolyDecRingElem{AbsSimpleNumFieldElem, AbstractAlgebra.Generic.MPoly{AbsSimpleNumFieldElem}}}:
 x[1]^4 - 8*x[1]*x[2]^3
 x[1]^6 + 20*x[1]^3*x[2]^3 - 8*x[2]^6

julia> is_unitary(W)
false
```

Note that the CHEVIE model is not unitary anymore, however. There is always a prize to pay
when choosing models. Both the models from [LT09](@cite) and from [MM10](@cite) involve
fractions. The models implemented in [BCP97](@cite) (by Taylor) have the advantage of being
defined over the ring of integers in a cyclotomic field, so they do not involve fractions:

```jldoctest
julia> W = complex_reflection_group(4, :Magma)
Matrix group of degree 2
  over cyclotomic field of order 3

julia> gens(W)
2-element Vector{MatrixGroupElem{AbsSimpleNumFieldElem, AbstractAlgebra.Generic.MatSpaceElem{AbsSimpleNumFieldElem}}}:
 [z_3 0; -z_3-1 1]
 [1 z_3+1; 0 z_3]
```

This illustrates that having available different models is useful in practice and we
therefore support this in our implementation.

Another feature of our implementation is that we do not just implement matrix models but 

```jldoctest
julia> W = complex_reflection_group_type([23, (2,1,4)])
Complex reflection group type G23 x G(2,1,4)

julia> order(W)
46080

julia> num_reflections(W)
31

julia> is_primitive(W)
true
```
